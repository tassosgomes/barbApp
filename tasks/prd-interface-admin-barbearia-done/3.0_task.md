---
status: completed
parallelizable: false
blocked_by: ["1.0"]
---

<task_context>
<domain>backend/application/usecases</domain>
<type>implementation</type>
<scope>configuration</scope>
<complexity>low</complexity>
<dependencies>email_service</dependencies>
<unblocks></unblocks>
</task_context>

# Tarefa 3.0: Atualizar template de email de boas-vindas

## Vis√£o Geral

Modificar o `CreateBarbershopUseCase` para incluir o link personalizado `http://app.barbapp.com/{codigo}/login` no email de boas-vindas enviado ao Admin Barbearia. Esta altera√ß√£o melhora a UX eliminando a necessidade de o usu√°rio navegar manualmente at√© a p√°gina de login.

<requirements>
- Atualizar template de email no `CreateBarbershopUseCase`
- Incluir URL personalizada: `http://app.barbapp.com/{codigo}/login`
- Manter informa√ß√µes existentes (nome, c√≥digo, email, senha)
- Validar que c√≥digo da barbearia est√° dispon√≠vel no momento do envio
- Garantir que URL est√° corretamente formatada
</requirements>

## Subtarefas

- [x] 3.1 Localizar `CreateBarbershopUseCase` em `BarbApp.Application/UseCases/`
- [x] 3.2 Identificar onde o email de boas-vindas √© enviado
- [x] 3.3 Atualizar template de email HTML/texto
- [x] 3.4 Adicionar URL personalizada com c√≥digo da barbearia
- [x] 3.5 Atualizar vari√°veis de ambiente se necess√°rio (base URL)
- [x] 3.6 Testar envio de email com novo template
- [x] 3.7 Validar formata√ß√£o em diferentes clientes de email
- [x] 3.8 Atualizar testes unit√°rios do use case
- [x] 3.9 Documentar formato do email no README

## Sequenciamento

- **Bloqueado por:** 1.0 (Endpoint de valida√ß√£o deve existir)
- **Desbloqueia:** Nenhuma (melhoria isolada)
- **Paraleliz√°vel:** N√£o (depende de 1.0)

## Detalhes de Implementa√ß√£o

### Localiza√ß√£o do C√≥digo

```csharp
// BarbApp.Application/UseCases/CreateBarbershopUseCase.cs
public async Task<Barbershop> ExecuteAsync(CreateBarbershopInput input)
{
    // ... existing logic to create barbershop
    
    // Enviar email de boas-vindas
    await _emailService.SendWelcomeEmailAsync(
        toEmail: adminEmail,
        barbershopName: barbearia.Nome,
        codigo: barbearia.Codigo,
        loginUrl: $"{_appSettings.FrontendUrl}/{barbearia.Codigo}/login",
        email: adminEmail,
        temporaryPassword: generatedPassword
    );
    
    return barbearia;
}
```

### Template de Email Atualizado

**HTML:**
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bem-vindo ao BarbApp</title>
</head>
<body style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
    <div style="background-color: #f8f9fa; padding: 20px;">
        <h1 style="color: #343a40;">ü™í Bem-vindo ao BarbApp</h1>
        
        <p>Ol√°, <strong>{{adminName}}</strong>!</p>
        
        <p>Sua barbearia foi cadastrada com sucesso no BarbApp!</p>
        
        <div style="background-color: white; padding: 15px; border-radius: 5px; margin: 20px 0;">
            <p><strong>Nome:</strong> {{barbershopName}}</p>
            <p><strong>C√≥digo:</strong> {{codigo}}</p>
        </div>
        
        <p>Para acessar o painel administrativo, clique no bot√£o abaixo:</p>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="{{loginUrl}}" 
               style="background-color: #007bff; 
                      color: white; 
                      padding: 12px 30px; 
                      text-decoration: none; 
                      border-radius: 5px;
                      display: inline-block;">
                Acessar Painel Administrativo
            </a>
        </div>
        
        <p>Ou copie e cole este link no seu navegador:</p>
        <p style="background-color: #e9ecef; padding: 10px; border-radius: 3px; word-break: break-all;">
            {{loginUrl}}
        </p>
        
        <div style="background-color: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0;">
            <p><strong>Suas credenciais de acesso:</strong></p>
            <p><strong>Email:</strong> {{email}}</p>
            <p><strong>Senha tempor√°ria:</strong> {{temporaryPassword}}</p>
            <p style="color: #856404; margin-top: 10px;">
                ‚ö†Ô∏è <em>Recomendamos alterar sua senha no primeiro acesso.</em>
            </p>
        </div>
        
        <p>Qualquer d√∫vida, entre em contato com nosso suporte.</p>
        
        <p>Atenciosamente,<br>Equipe BarbApp</p>
    </div>
</body>
</html>
```

**Texto Plano (fallback):**
```text
Bem-vindo ao BarbApp

Ol√°, {{adminName}}!

Sua barbearia foi cadastrada com sucesso!

Nome: {{barbershopName}}
C√≥digo: {{codigo}}

Acesse o painel administrativo em:
{{loginUrl}}

Suas credenciais de acesso:
Email: {{email}}
Senha tempor√°ria: {{temporaryPassword}}

‚ö†Ô∏è Recomendamos alterar sua senha no primeiro acesso.

Atenciosamente,
Equipe BarbApp
```

### Vari√°veis de Ambiente

```bash
# .env ou appsettings.json
FRONTEND_URL=http://app.barbapp.com
# ou para desenvolvimento:
FRONTEND_URL=http://localhost:3000
```

## Crit√©rios de Sucesso

- [x] Email enviado cont√©m URL personalizada `{baseUrl}/{codigo}/login`
- [x] URL est√° corretamente formatada e clic√°vel
- [x] Email cont√©m todas as informa√ß√µes necess√°rias (nome, c√≥digo, email, senha)
- [x] Template funciona em HTML e texto plano
- [x] Template renderiza corretamente em Gmail, Outlook, Apple Mail
- [x] Vari√°veis de ambiente documentadas
- [x] Testes unit√°rios atualizados
- [x] Exemplo de email documentado no README

## Arquivos Afetados

- `BarbApp.Application/UseCases/CreateBarbershopUseCase.cs` (MODIFICADO)
- `BarbApp.Application/Services/EmailService.cs` (MODIFICADO - se template estiver aqui)
- `BarbApp.Application/Templates/WelcomeEmail.html` (MODIFICADO - se existir)
- `BarbApp.API/appsettings.json` (MODIFICADO - adicionar FRONTEND_URL)
- `BarbApp.Application.Tests/UseCases/CreateBarbershopUseCaseTests.cs` (MODIFICADO)
- `README.md` (MODIFICADO - documentar template)

## Estimativa

- **Esfor√ßo:** 0.5-1 dia
- **Complexidade:** Baixa
