---
status: pending
parallelizable: false
blocked_by: ["12.0"]
---

<task_context>
<domain>frontend/pages/agenda</domain>
<type>implementation</type>
<scope>core_feature</scope>
<complexity>medium</complexity>
<dependencies>http_server</dependencies>
<unblocks>14.0</unblocks>
</task_context>

# Tarefa 13.0: Implementar visualização de agendamentos

## Visão Geral

Criar página de visualização de agendamentos com filtros por barbeiro, data e status. Admin Barbearia pode visualizar agendamentos mas não criar/editar (funcionalidade futura).

<requirements>
- Listagem de agendamentos com DataTable
- Filtros: barbeiro, data, status
- Exibir detalhes: cliente, barbeiro, serviço, horário
- Modal de detalhes do agendamento
- Paginação
- Apenas visualização (sem edição)
</requirements>

## Subtarefas

- [ ] 13.1 Criar tipos em `src/types/agendamento.ts`
- [ ] 13.2 Criar serviço `src/services/agendamento.service.ts`
- [ ] 13.3 Criar `src/pages/Agenda/AgendaListPage.tsx`
- [ ] 13.4 Implementar DataTable
- [ ] 13.5 Adicionar filtros (barbeiro, data, status)
- [ ] 13.6 Criar modal `AgendamentoDetailsModal`
- [ ] 13.7 Implementar formatação de data/hora
- [ ] 13.8 Adicionar badges de status
- [ ] 13.9 Criar testes unitários
- [ ] 13.10 Adicionar rota

## Detalhes de Implementação

### Tipos

```typescript
// src/types/agendamento.ts
export interface Agendamento {
  id: string;
  clienteNome: string;
  clienteTelefone: string;
  barbeiroId: string;
  barbeiroNome: string;
  servicoId: string;
  servicoNome: string;
  dataHora: string;
  status: 'Pendente' | 'Confirmado' | 'Concluido' | 'Cancelado';
  createdAt: string;
}

export interface ListAgendamentosParams {
  page?: number;
  pageSize?: number;
  barbeiroId?: string;
  dataInicio?: string;
  dataFim?: string;
  status?: string;
}
```

### Serviço

```typescript
// src/services/agendamento.service.ts
import { api } from './api';
import type { Agendamento, ListAgendamentosParams, PaginatedResponse } from '@/types';

export const agendamentoService = {
  list: async (params: ListAgendamentosParams = {}): Promise<PaginatedResponse<Agendamento>> => {
    const response = await api.get<PaginatedResponse<Agendamento>>('/api/agendamentos', { params });
    return response.data;
  },

  getById: async (id: string): Promise<Agendamento> => {
    const response = await api.get<Agendamento>(`/api/agendamentos/${id}`);
    return response.data;
  },
};
```

### Página de Listagem

```typescript
// src/pages/Agenda/AgendaListPage.tsx
import { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { agendamentoService } from '@/services/agendamento.service';
import { barbeiroService } from '@/services/barbeiro.service';
import { useBarbearia } from '@/contexts/BarbeariaContext';
import { DataTable } from '@/components/DataTable';
import { Select } from '@/components/ui/select';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { formatDateTime } from '@/utils/formatters';
import { AgendamentoDetailsModal } from '@/components/AgendamentoDetailsModal';

export function AgendaListPage() {
  const { barbearia } = useBarbearia();
  const [page, setPage] = useState(1);
  const [barbeiroId, setBarbeiroId] = useState<string>();
  const [dataInicio, setDataInicio] = useState<string>();
  const [status, setStatus] = useState<string>();
  const [selectedAgendamento, setSelectedAgendamento] = useState<string | null>(null);

  const { data: agendamentos, isLoading } = useQuery({
    queryKey: ['agendamentos', barbearia?.barbeariaId, page, barbeiroId, dataInicio, status],
    queryFn: () =>
      agendamentoService.list({
        page,
        pageSize: 10,
        barbeiroId,
        dataInicio,
        status,
      }),
    enabled: !!barbearia,
  });

  const { data: barbeiros } = useQuery({
    queryKey: ['barbeiros-all'],
    queryFn: () => barbeiroService.list({ pageSize: 100 }),
  });

  const getStatusBadge = (status: string) => {
    const variants = {
      Pendente: 'secondary',
      Confirmado: 'default',
      Concluido: 'success',
      Cancelado: 'destructive',
    };
    return <Badge variant={variants[status as keyof typeof variants]}>{status}</Badge>;
  };

  const columns = [
    {
      header: 'Data/Hora',
      cell: ({ row }: any) => formatDateTime(row.original.dataHora),
    },
    { header: 'Cliente', accessorKey: 'clienteNome' },
    { header: 'Barbeiro', accessorKey: 'barbeiroNome' },
    { header: 'Serviço', accessorKey: 'servicoNome' },
    {
      header: 'Status',
      cell: ({ row }: any) => getStatusBadge(row.original.status),
    },
    {
      header: 'Ações',
      cell: ({ row }: any) => (
        <Button
          size="sm"
          variant="outline"
          onClick={() => setSelectedAgendamento(row.original.id)}
        >
          Ver Detalhes
        </Button>
      ),
    },
  ];

  return (
    <div className="space-y-4">
      <h1 className="text-2xl font-bold">Agendamentos</h1>

      <div className="flex gap-4">
        <Select value={barbeiroId} onValueChange={setBarbeiroId}>
          <option value="">Todos os barbeiros</option>
          {barbeiros?.items.map((b) => (
            <option key={b.id} value={b.id}>
              {b.nome}
            </option>
          ))}
        </Select>

        <Input
          type="date"
          value={dataInicio}
          onChange={(e) => setDataInicio(e.target.value)}
        />

        <Select value={status} onValueChange={setStatus}>
          <option value="">Todos os status</option>
          <option value="Pendente">Pendente</option>
          <option value="Confirmado">Confirmado</option>
          <option value="Concluido">Concluído</option>
          <option value="Cancelado">Cancelado</option>
        </Select>
      </div>

      <DataTable
        columns={columns}
        data={agendamentos?.items ?? []}
        isLoading={isLoading}
        pagination={{
          page,
          pageSize: 10,
          totalPages: agendamentos?.totalPages ?? 0,
          onPageChange: setPage,
        }}
      />

      {selectedAgendamento && (
        <AgendamentoDetailsModal
          agendamentoId={selectedAgendamento}
          onClose={() => setSelectedAgendamento(null)}
        />
      )}
    </div>
  );
}
```

### Modal de Detalhes

```typescript
// src/components/AgendamentoDetailsModal.tsx
import { useQuery } from '@tanstack/react-query';
import { agendamentoService } from '@/services/agendamento.service';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { formatDateTime } from '@/utils/formatters';

interface AgendamentoDetailsModalProps {
  agendamentoId: string;
  onClose: () => void;
}

export function AgendamentoDetailsModal({ agendamentoId, onClose }: AgendamentoDetailsModalProps) {
  const { data: agendamento, isLoading } = useQuery({
    queryKey: ['agendamento', agendamentoId],
    queryFn: () => agendamentoService.getById(agendamentoId),
  });

  return (
    <Dialog open onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Detalhes do Agendamento</DialogTitle>
        </DialogHeader>
        {isLoading ? (
          <div>Carregando...</div>
        ) : (
          <div className="space-y-3">
            <div>
              <p className="text-sm text-gray-600">Cliente</p>
              <p className="font-medium">{agendamento?.clienteNome}</p>
              <p className="text-sm">{agendamento?.clienteTelefone}</p>
            </div>
            <div>
              <p className="text-sm text-gray-600">Barbeiro</p>
              <p className="font-medium">{agendamento?.barbeiroNome}</p>
            </div>
            <div>
              <p className="text-sm text-gray-600">Serviço</p>
              <p className="font-medium">{agendamento?.servicoNome}</p>
            </div>
            <div>
              <p className="text-sm text-gray-600">Data e Hora</p>
              <p className="font-medium">{formatDateTime(agendamento?.dataHora || '')}</p>
            </div>
            <div>
              <p className="text-sm text-gray-600">Status</p>
              <p className="font-medium">{agendamento?.status}</p>
            </div>
          </div>
        )}
      </DialogContent>
    </Dialog>
  );
}
```

## Critérios de Sucesso

- [ ] Listagem exibe agendamentos corretamente
- [ ] Filtros funcionam (barbeiro, data, status)
- [ ] Modal de detalhes exibe todas informações
- [ ] Formatação de data/hora correta
- [ ] Badges de status coloridos
- [ ] Paginação funciona
- [ ] Testes >= 80%

## Arquivos Afetados

- `src/types/agendamento.ts` (NOVO)
- `src/services/agendamento.service.ts` (NOVO)
- `src/pages/Agenda/AgendaListPage.tsx` (NOVO)
- `src/components/AgendamentoDetailsModal.tsx` (NOVO)
- `src/utils/formatters.ts` (MODIFICADO)
- `src/routes/adminBarbearia.routes.tsx` (MODIFICADO)

## Estimativa

- **Esforço:** 2 dias
- **Complexidade:** Média
