---
status: pending
parallelizable: false
blocked_by: ["11.0"]
---

<task_context>
<domain>frontend/pages/servicos</domain>
<type>implementation</type>
<scope>core_feature</scope>
<complexity>medium</complexity>
<dependencies>http_server</dependencies>
<unblocks>13.0</unblocks>
</task_context>

# Tarefa 12.0: Implementar páginas de listagem e formulário de serviços

## Visão Geral

Criar páginas completas para gestão de serviços: listagem com DataTable, formulário de criação/edição. Similar à tarefa 10.0, mas focado em serviços.

<requirements>
- Página de listagem com DataTable
- Filtros e busca
- Formulário de criação/edição
- Validação de preço e duração
- Formatação de valores monetários
- Ações de desativar/reativar
</requirements>

## Subtarefas

- [ ] 12.1 Criar `src/pages/Servicos/ServicosListPage.tsx`
- [ ] 12.2 Implementar DataTable
- [ ] 12.3 Adicionar filtros
- [ ] 12.4 Criar `src/pages/Servicos/ServicoFormPage.tsx`
- [ ] 12.5 Implementar formulário com validações
- [ ] 12.6 Adicionar formatação de preço (R$)
- [ ] 12.7 Implementar conversão de duração (minutos)
- [ ] 12.8 Criar testes unitários
- [ ] 12.9 Adicionar rotas

## Detalhes de Implementação

### Listagem

```typescript
// src/pages/Servicos/ServicosListPage.tsx
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { servicoService } from '@/services/servico.service';
import { useBarbearia } from '@/contexts/BarbeariaContext';
import { DataTable } from '@/components/DataTable';
import { Button } from '@/components/ui/button';
import { formatCurrency, formatDuration } from '@/utils/formatters';

export function ServicosListPage() {
  const navigate = useNavigate();
  const { barbearia } = useBarbearia();
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);

  const { data, isLoading } = useQuery({
    queryKey: ['servicos', barbearia?.barbeariaId, page],
    queryFn: () => servicoService.list({ page, pageSize: 10 }),
    enabled: !!barbearia,
  });

  const columns = [
    { header: 'Nome', accessorKey: 'nome' },
    { 
      header: 'Duração', 
      cell: ({ row }: any) => formatDuration(row.original.duracaoMinutos) 
    },
    { 
      header: 'Preço', 
      cell: ({ row }: any) => formatCurrency(row.original.preco) 
    },
    {
      header: 'Status',
      cell: ({ row }: any) => (
        <span className={row.original.isActive ? 'text-green-600' : 'text-red-600'}>
          {row.original.isActive ? 'Ativo' : 'Inativo'}
        </span>
      ),
    },
    {
      header: 'Ações',
      cell: ({ row }: any) => (
        <div className="flex gap-2">
          <Button
            size="sm"
            onClick={() => navigate(`/${barbearia?.codigo}/servicos/${row.original.id}`)}
          >
            Editar
          </Button>
        </div>
      ),
    },
  ];

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">Serviços</h1>
        <Button onClick={() => navigate(`/${barbearia?.codigo}/servicos/novo`)}>
          Novo Serviço
        </Button>
      </div>

      <DataTable
        columns={columns}
        data={data?.items ?? []}
        isLoading={isLoading}
        pagination={{
          page,
          pageSize: 10,
          totalPages: data?.totalPages ?? 0,
          onPageChange: setPage,
        }}
      />
    </div>
  );
}
```

### Formulário

```typescript
// src/pages/Servicos/ServicoFormPage.tsx
import { useNavigate, useParams } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQuery } from '@tanstack/react-query';
import { servicoService } from '@/services/servico.service';
import { createServicoSchema, type CreateServicoFormData } from '@/schemas/servico.schema';
import { useBarbearia } from '@/contexts/BarbeariaContext';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { toast } from 'sonner';

export function ServicoFormPage() {
  const navigate = useNavigate();
  const { id } = useParams();
  const { barbearia } = useBarbearia();
  const isEditing = !!id;

  const { data: servico } = useQuery({
    queryKey: ['servico', id],
    queryFn: () => servicoService.getById(id!),
    enabled: isEditing,
  });

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<CreateServicoFormData>({
    resolver: zodResolver(createServicoSchema),
    defaultValues: servico,
  });

  const mutation = useMutation({
    mutationFn: (data: CreateServicoFormData) =>
      isEditing
        ? servicoService.update(id!, data)
        : servicoService.create(data),
    onSuccess: () => {
      toast.success(`Serviço ${isEditing ? 'atualizado' : 'criado'} com sucesso`);
      navigate(`/${barbearia?.codigo}/servicos`);
    },
  });

  return (
    <div className="max-w-2xl mx-auto">
      <Card>
        <CardHeader>
          <CardTitle>{isEditing ? 'Editar Serviço' : 'Novo Serviço'}</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit((data) => mutation.mutate(data))} className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Nome</label>
              <Input {...register('nome')} />
              {errors.nome && <p className="text-sm text-red-600">{errors.nome.message}</p>}
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Descrição</label>
              <Textarea {...register('descricao')} />
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Duração (minutos)</label>
              <Input type="number" {...register('duracaoMinutos', { valueAsNumber: true })} />
              {errors.duracaoMinutos && (
                <p className="text-sm text-red-600">{errors.duracaoMinutos.message}</p>
              )}
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Preço (R$)</label>
              <Input type="number" step="0.01" {...register('preco', { valueAsNumber: true })} />
              {errors.preco && <p className="text-sm text-red-600">{errors.preco.message}</p>}
            </div>

            <div className="flex gap-2">
              <Button type="submit" disabled={mutation.isPending}>
                {mutation.isPending ? 'Salvando...' : 'Salvar'}
              </Button>
              <Button
                type="button"
                variant="outline"
                onClick={() => navigate(`/${barbearia?.codigo}/servicos`)}
              >
                Cancelar
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
```

### Utilitários de Formatação

```typescript
// src/utils/formatters.ts
export function formatCurrency(value: number): string {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL',
  }).format(value);
}

export function formatDuration(minutes: number): string {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  
  if (hours > 0) {
    return `${hours}h${mins > 0 ? ` ${mins}min` : ''}`;
  }
  
  return `${mins}min`;
}
```

## Critérios de Sucesso

- [ ] Listagem exibe serviços corretamente
- [ ] Preço formatado em R$
- [ ] Duração formatada (ex: "1h 30min")
- [ ] Formulário de criação funciona
- [ ] Formulário de edição funciona
- [ ] Validações funcionam
- [ ] Testes >= 80%

## Arquivos Afetados

- `src/pages/Servicos/ServicosListPage.tsx` (NOVO)
- `src/pages/Servicos/ServicoFormPage.tsx` (NOVO)
- `src/utils/formatters.ts` (NOVO)
- `src/routes/adminBarbearia.routes.tsx` (MODIFICADO)

## Estimativa

- **Esforço:** 2 dias
- **Complexidade:** Média
