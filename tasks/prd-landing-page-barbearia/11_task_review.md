# Relat√≥rio de Revis√£o - Tarefa 11.0: Hook useLandingPage e API Service

**Data**: 2025-10-21  
**Revisor**: GitHub Copilot  
**Status da Tarefa**: ‚ùå **N√ÉO CONCLU√çDA**

---

## 1. Resumo Executivo

### 1.1. Vis√£o Geral
A Tarefa 11.0 visa implementar o hook customizado `useLandingPage` e o servi√ßo de API `landing-page.api.ts` para gerenciar estado e opera√ß√µes da landing page no painel admin, incluindo integra√ß√£o com backend via TanStack Query.

### 1.2. Status Atual
**CR√çTICO**: A tarefa est√° **INCOMPLETA**. An√°lise detalhada revela que:

- ‚úÖ **Parcialmente Implementado**: Types e interfaces criados (Tarefa 10.0)
- ‚ùå **N√ÉO IMPLEMENTADO**: Hook `useLandingPage`
- ‚ùå **N√ÉO IMPLEMENTADO**: Servi√ßo de API `landing-page.api.ts`
- ‚ùå **N√ÉO IMPLEMENTADO**: Integra√ß√£o com TanStack Query
- ‚ùå **N√ÉO IMPLEMENTADO**: Tratamento de erros e toasts
- ‚ùå **N√ÉO IMPLEMENTADO**: Testes unit√°rios

### 1.3. Veredicto Final
üî¥ **REPROVADO** - A implementa√ß√£o est√° ausente. Apenas a base de types foi criada pela Tarefa 10.0. Os componentes principais (hook e API service) n√£o foram implementados.

---

## 2. Valida√ß√£o da Defini√ß√£o da Tarefa

### 2.1. Alinhamento com PRD
**Status**: ‚úÖ Requisitos bem definidos no PRD

| Requisito PRD | Relev√¢ncia | Cobertura |
|---------------|-----------|-----------|
| Gest√£o de configura√ß√£o da landing page | ‚úÖ | ‚ùå N√£o implementado |
| Atualiza√ß√£o de informa√ß√µes | ‚úÖ | ‚ùå N√£o implementado |
| Upload de logo | ‚úÖ | ‚ùå N√£o implementado |
| Integra√ß√£o com backend | ‚úÖ | ‚ùå N√£o implementado |

### 2.2. Alinhamento com Tech Spec
**Status**: ‚úÖ Especifica√ß√£o t√©cnica completa em `techspec-frontend.md` se√ß√£o 1.3

O Tech Spec fornece:
- ‚úÖ C√≥digo completo do hook `useLandingPage`
- ‚úÖ C√≥digo completo do API service
- ‚úÖ Exemplos de integra√ß√£o com TanStack Query
- ‚úÖ Tratamento de erros e toasts

**Problema**: C√≥digo de refer√™ncia existe na spec, mas N√ÉO foi implementado no projeto.

### 2.3. Alinhamento com Arquivo de Tarefa
**Status**: ‚úÖ Taref definida claramente em `11_task.md`

**Subtarefas Definidas**:
- [ ] 11.1 Criar `services/api/landing-page.api.ts` ‚ùå
- [ ] 11.2 Criar hook `useLandingPage.ts` ‚ùå
- [ ] 11.3 Implementar query para buscar config ‚ùå
- [ ] 11.4 Implementar mutation para atualizar ‚ùå
- [ ] 11.5 Adicionar tratamento de erros e toasts ‚ùå
- [ ] 11.6 Criar testes do hook ‚ùå

**Todas as subtarefas est√£o pendentes.**

### 2.4. Depend√™ncias
**Status**: ‚ö†Ô∏è Bloqueadores parcialmente resolvidos

| Depend√™ncia | Status | Impacto |
|-------------|--------|---------|
| Tarefa 10.0 (Types) | ‚úÖ Conclu√≠da | Sem bloqueio |
| Tarefa 5.0 (API Endpoints Backend) | ‚ö†Ô∏è Status desconhecido | **BLOQUEIO POTENCIAL** |

**A√ß√£o Necess√°ria**: Verificar se a Tarefa 5.0 (API Backend) est√° completa antes de prosseguir.

---

## 3. An√°lise de Regras e Revis√£o de C√≥digo

### 3.1. Regras Aplic√°veis

#### 3.1.1. `rules/react.md`
**Regras Relevantes**:
- ‚úÖ Utilizar componentes funcionais (N/A - √© um hook)
- ‚úÖ Utilizar TypeScript e extens√£o .ts
- ‚úÖ React Query para comunica√ß√£o com API
- ‚úÖ Nomear hooks com "use"
- ‚ùå **VIOLA√á√ÉO**: Criar testes automatizados para todos os componentes/hooks

**Conformidade**: 0% (nenhum c√≥digo implementado)

#### 3.1.2. `rules/code-standard.md`
**Regras Relevantes**:
- ‚úÖ Utilizar camelCase para fun√ß√µes e vari√°veis
- ‚úÖ Evitar m√©todos longos (m√°x. 50 linhas)
- ‚úÖ Declarar constantes para magic numbers
- ‚úÖ Inverter depend√™ncias (Dependency Inversion)

**Conformidade**: N/A (aguardando implementa√ß√£o)

#### 3.1.3. `rules/tests-react.md`
**Regras Relevantes**:
- ‚ùå **VIOLA√á√ÉO CR√çTICA**: Criar testes de unidade para todos os custom hooks
- ‚ùå **VIOLA√á√ÉO**: Utilizar React Testing Library (`renderHook`)
- ‚ùå **VIOLA√á√ÉO**: Estrutura AAA (Arrange, Act, Assert)
- ‚ùå **VIOLA√á√ÉO**: Mockar depend√™ncias externas (API calls)

**Conformidade**: 0% (testes ausentes)

### 3.2. An√°lise da Estrutura do Projeto

**Estrutura Existente**:
```
barbapp-admin/src/
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îî‚îÄ‚îÄ landing-page/
‚îÇ       ‚îú‚îÄ‚îÄ types/           ‚úÖ Criado
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ landing-page.types.ts
‚îÇ       ‚îú‚îÄ‚îÄ constants/       ‚úÖ Criado
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ templates.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ validation.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts         ‚úÖ Criado
‚îú‚îÄ‚îÄ hooks/                   ‚ùå Hook ausente
‚îÇ   ‚îî‚îÄ‚îÄ (nenhum landing page hook)
‚îî‚îÄ‚îÄ services/                ‚ùå API service ausente
    ‚îî‚îÄ‚îÄ (nenhum landing-page.api.ts)
```

**Problemas Identificados**:
1. ‚ùå Diret√≥rio `features/landing-page/hooks/` n√£o existe
2. ‚ùå Arquivo `hooks/useLandingPage.ts` n√£o existe
3. ‚ùå Diret√≥rio `features/landing-page/services/` n√£o existe
4. ‚ùå Arquivo `services/api/landing-page.api.ts` n√£o existe
5. ‚ùå Nenhum teste em `__tests__/`

---

## 4. Problemas Cr√≠ticos Identificados

### 4.1. Implementa√ß√£o Ausente

#### üî¥ **CR√çTICO 1: Hook `useLandingPage` n√£o implementado**
**Severidade**: ALTA  
**Impacto**: Bloqueia todas as tarefas dependentes (17.0, 18.0)

**Evid√™ncia**:
- Busca por `useLandingPage` retorna apenas refer√™ncias em types
- Arquivo `hooks/useLandingPage.ts` n√£o existe
- Nenhuma implementa√ß√£o de TanStack Query encontrada

**A√ß√£o Requerida**:
```typescript
// Criar: barbapp-admin/src/features/landing-page/hooks/useLandingPage.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { landingPageApi } from '@/services/api/landing-page.api';
import { toast } from '@/components/ui/use-toast';
import type { UseLandingPageResult, UpdateLandingPageInput } from '../types/landing-page.types';

export const useLandingPage = (barbershopId: string): UseLandingPageResult => {
  const queryClient = useQueryClient();

  const { data: config, isLoading, error } = useQuery({
    queryKey: ['landingPage', barbershopId],
    queryFn: () => landingPageApi.getConfig(barbershopId),
    staleTime: 5 * 60 * 1000,
  });

  const updateMutation = useMutation({
    mutationFn: (data: UpdateLandingPageInput) =>
      landingPageApi.updateConfig(barbershopId, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['landingPage', barbershopId] });
      toast({
        title: 'Sucesso!',
        description: 'Landing page atualizada com sucesso.',
        variant: 'success',
      });
    },
    onError: (error: any) => {
      toast({
        title: 'Erro',
        description: error.message || 'Erro ao atualizar landing page.',
        variant: 'destructive',
      });
    },
  });

  return {
    config,
    isLoading,
    error: error as Error,
    updateConfig: updateMutation.mutateAsync,
    isUpdating: updateMutation.isPending,
    refetch: async () => {
      await queryClient.invalidateQueries({ queryKey: ['landingPage', barbershopId] });
    },
  };
};
```

#### üî¥ **CR√çTICO 2: API Service n√£o implementado**
**Severidade**: ALTA  
**Impacto**: Hook n√£o pode funcionar sem o service

**Evid√™ncia**:
- Arquivo `services/api/landing-page.api.ts` n√£o existe
- Nenhuma integra√ß√£o com axios/fetch encontrada
- Endpoints definidos no backend n√£o t√™m client correspondente

**A√ß√£o Requerida**:
```typescript
// Criar: barbapp-admin/src/services/api/landing-page.api.ts
import { api } from './api';
import type { 
  LandingPageConfig, 
  UpdateLandingPageInput,
  LandingPageConfigOutput 
} from '@/features/landing-page/types/landing-page.types';

export const landingPageApi = {
  /**
   * Busca configura√ß√£o da landing page
   */
  getConfig: async (barbershopId: string): Promise<LandingPageConfig> => {
    const { data } = await api.get<LandingPageConfigOutput>(
      `/admin/landing-pages/${barbershopId}`
    );
    return data.landingPage;
  },

  /**
   * Atualiza configura√ß√£o da landing page
   */
  updateConfig: async (
    barbershopId: string,
    payload: UpdateLandingPageInput
  ): Promise<void> => {
    await api.put(`/admin/landing-pages/${barbershopId}`, payload);
  },

  /**
   * Upload de logo
   */
  uploadLogo: async (barbershopId: string, file: File): Promise<string> => {
    const formData = new FormData();
    formData.append('logo', file);

    const { data } = await api.post<{ logoUrl: string }>(
      `/admin/landing-pages/${barbershopId}/logo`,
      formData,
      {
        headers: { 'Content-Type': 'multipart/form-data' },
      }
    );

    return data.logoUrl;
  },
};
```

#### üî¥ **CR√çTICO 3: Testes completamente ausentes**
**Severidade**: ALTA  
**Impacto**: Viola√ß√£o de regras do projeto + imposs√≠vel validar funcionamento

**Evid√™ncia**:
- Nenhum arquivo de teste em `__tests__/`
- Busca por `landing-page.test` retorna vazio
- Regra `tests-react.md` exige testes para todos os hooks

**A√ß√£o Requerida**:
```typescript
// Criar: barbapp-admin/src/features/landing-page/hooks/__tests__/useLandingPage.test.ts
import { renderHook, waitFor } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { useLandingPage } from '../useLandingPage';
import { landingPageApi } from '@/services/api/landing-page.api';

jest.mock('@/services/api/landing-page.api');

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: { queries: { retry: false } },
  });
  return ({ children }: any) => (
    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
  );
};

describe('useLandingPage', () => {
  const mockBarbershopId = '123';
  const mockConfig = {
    id: '1',
    barbershopId: mockBarbershopId,
    templateId: 1,
    whatsappNumber: '+5511999999999',
    isPublished: true,
    services: [],
    updatedAt: '2025-10-21',
    createdAt: '2025-10-21',
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('should fetch landing page config', async () => {
    (landingPageApi.getConfig as jest.Mock).mockResolvedValue(mockConfig);

    const { result } = renderHook(() => useLandingPage(mockBarbershopId), {
      wrapper: createWrapper(),
    });

    await waitFor(() => expect(result.current.isLoading).toBe(false));

    expect(result.current.config).toEqual(mockConfig);
    expect(landingPageApi.getConfig).toHaveBeenCalledWith(mockBarbershopId);
  });

  it('should update landing page config', async () => {
    (landingPageApi.getConfig as jest.Mock).mockResolvedValue(mockConfig);
    (landingPageApi.updateConfig as jest.Mock).mockResolvedValue(undefined);

    const { result } = renderHook(() => useLandingPage(mockBarbershopId), {
      wrapper: createWrapper(),
    });

    await waitFor(() => expect(result.current.isLoading).toBe(false));

    const updateData = { aboutText: 'Novo texto' };
    await result.current.updateConfig(updateData);

    expect(landingPageApi.updateConfig).toHaveBeenCalledWith(
      mockBarbershopId,
      updateData
    );
  });

  it('should handle errors', async () => {
    const mockError = new Error('API Error');
    (landingPageApi.getConfig as jest.Mock).mockRejectedValue(mockError);

    const { result } = renderHook(() => useLandingPage(mockBarbershopId), {
      wrapper: createWrapper(),
    });

    await waitFor(() => expect(result.current.isLoading).toBe(false));

    expect(result.current.error).toBeDefined();
  });
});
```

### 4.2. Problemas de Arquitetura

#### ‚ö†Ô∏è **M√âDIO 1: Organiza√ß√£o de diret√≥rios inconsistente**
**Severidade**: M√âDIA  
**Impacto**: Dificulta manuten√ß√£o e escalabilidade

**Problema**:
- Types est√£o em `features/landing-page/types/`
- Hooks deveriam estar em `features/landing-page/hooks/` mas est√£o ausentes
- Services deveriam estar em `services/api/` mas est√£o ausentes

**Recomenda√ß√£o**:
```
barbapp-admin/src/features/landing-page/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useLandingPage.ts
‚îÇ   ‚îú‚îÄ‚îÄ useTemplates.ts
‚îÇ   ‚îú‚îÄ‚îÄ useLogoUpload.ts
‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ       ‚îú‚îÄ‚îÄ useLandingPage.test.ts
‚îÇ       ‚îú‚îÄ‚îÄ useTemplates.test.ts
‚îÇ       ‚îî‚îÄ‚îÄ useLogoUpload.test.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ landing-page.api.ts
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ landing-page.types.ts
‚îî‚îÄ‚îÄ constants/
    ‚îú‚îÄ‚îÄ templates.ts
    ‚îî‚îÄ‚îÄ validation.ts
```

#### ‚ö†Ô∏è **M√âDIO 2: Falta integra√ß√£o com inst√¢ncia API existente**
**Severidade**: M√âDIA  
**Impacto**: Pode causar duplica√ß√£o de configura√ß√£o HTTP

**Problema**:
- Projeto j√° tem inst√¢ncia configurada do axios em `services/api.ts`
- API service deve reutilizar essa inst√¢ncia

**Recomenda√ß√£o**:
```typescript
// Importar inst√¢ncia existente
import { api } from '../api';

// Usar api em vez de criar nova inst√¢ncia axios
export const landingPageApi = {
  getConfig: async (barbershopId: string) => {
    const { data } = await api.get(`/admin/landing-pages/${barbershopId}`);
    return data;
  },
  // ...
};
```

### 4.3. Problemas de Qualidade

#### ‚ö†Ô∏è **M√âDIO 3: Falta valida√ß√£o de entrada**
**Severidade**: M√âDIA  
**Impacto**: Erros podem ser enviados ao backend desnecessariamente

**Recomenda√ß√£o**:
```typescript
export const useLandingPage = (barbershopId: string) => {
  // Validar barbershopId
  if (!barbershopId || !barbershopId.trim()) {
    throw new Error('barbershopId √© obrigat√≥rio');
  }

  // ... resto do hook
};
```

#### ‚ö†Ô∏è **BAIXO 1: Falta documenta√ß√£o JSDoc**
**Severidade**: BAIXA  
**Impacto**: Dificulta uso e manuten√ß√£o

**Recomenda√ß√£o**:
```typescript
/**
 * Hook customizado para gerenciar estado e opera√ß√µes da landing page.
 * 
 * @param barbershopId - ID da barbearia
 * @returns Objeto com config, loading, error e fun√ß√µes de atualiza√ß√£o
 * 
 * @example
 * ```typescript
 * const { config, updateConfig, isUpdating } = useLandingPage('123');
 * 
 * await updateConfig({
 *   aboutText: 'Nova descri√ß√£o'
 * });
 * ```
 */
export const useLandingPage = (barbershopId: string): UseLandingPageResult => {
  // ...
};
```

---

## 5. Valida√ß√£o de Testes e Cobertura

### 5.1. Status Atual
‚ùå **NENHUM TESTE IMPLEMENTADO**

**Evid√™ncia**:
- Busca por `__tests__/**/*landing-page*` retorna vazio
- Nenhum arquivo `.test.ts` ou `.spec.ts` encontrado
- Cobertura de testes: **0%**

### 5.2. Testes Necess√°rios

#### 5.2.1. Testes Unit√°rios do Hook
**Arquivo**: `hooks/__tests__/useLandingPage.test.ts`

**Casos de Teste Obrigat√≥rios**:
- ‚úÖ Deve buscar configura√ß√£o da landing page
- ‚úÖ Deve atualizar configura√ß√£o com sucesso
- ‚úÖ Deve invalidar cache ap√≥s atualiza√ß√£o
- ‚úÖ Deve exibir toast de sucesso ap√≥s atualiza√ß√£o
- ‚úÖ Deve tratar erros de busca
- ‚úÖ Deve tratar erros de atualiza√ß√£o
- ‚úÖ Deve exibir toast de erro em falhas
- ‚úÖ Deve fazer refetch manualmente
- ‚úÖ Deve respeitar staleTime de 5 minutos

#### 5.2.2. Testes de Integra√ß√£o do API Service
**Arquivo**: `services/api/__tests__/landing-page.api.test.ts`

**Casos de Teste Obrigat√≥rios**:
- ‚úÖ Deve chamar endpoint correto para getConfig
- ‚úÖ Deve chamar endpoint correto para updateConfig
- ‚úÖ Deve chamar endpoint correto para uploadLogo
- ‚úÖ Deve enviar FormData corretamente no upload
- ‚úÖ Deve propagar erros HTTP

### 5.3. Configura√ß√£o de Mocks

**Mock necess√°rio** para `landingPageApi`:
```typescript
// __mocks__/landing-page.api.ts
export const landingPageApi = {
  getConfig: jest.fn(),
  updateConfig: jest.fn(),
  uploadLogo: jest.fn(),
};
```

### 5.4. Conformidade com Regras de Teste

**Checklist `tests-react.md`**:
- ‚ùå Utilizar Jest como framework
- ‚ùå Utilizar React Testing Library
- ‚ùå Utilizar `renderHook` para hooks
- ‚ùå Estrutura AAA (Arrange, Act, Assert)
- ‚ùå Mockar depend√™ncias externas
- ‚ùå Usar `beforeEach` para limpeza
- ‚ùå Testes independentes e repet√≠veis

**Conformidade**: 0/7 (0%)

---

## 6. Checklist de Conclus√£o da Tarefa

### 6.1. Subtarefas
| ID | Subtarefa | Status | Prioridade |
|----|-----------|--------|------------|
| 11.1 | Criar `services/api/landing-page.api.ts` | ‚ùå Pendente | P0 |
| 11.2 | Criar hook `useLandingPage.ts` | ‚ùå Pendente | P0 |
| 11.3 | Implementar query para buscar config | ‚ùå Pendente | P0 |
| 11.4 | Implementar mutation para atualizar | ‚ùå Pendente | P0 |
| 11.5 | Adicionar tratamento de erros e toasts | ‚ùå Pendente | P0 |
| 11.6 | Criar testes do hook | ‚ùå Pendente | P0 |

**Progresso**: 0/6 (0%)

### 6.2. Crit√©rios de Sucesso
| Crit√©rio | Status | Observa√ß√µes |
|----------|--------|-------------|
| Hook funcionando e integrando com API | ‚ùå | Hook n√£o existe |
| Cache e invalida√ß√£o autom√°tica | ‚ùå | TanStack Query n√£o configurado |
| Toasts de sucesso/erro | ‚ùå | Tratamento de erros ausente |
| Testes unit√°rios passando | ‚ùå | Testes n√£o existem |

**Progresso**: 0/4 (0%)

### 6.3. Requisitos Obrigat√≥rios (PRD)
| Requisito | Status | Bloqueador? |
|-----------|--------|-------------|
| Integra√ß√£o com API backend | ‚ùå | Sim |
| Gerenciamento de estado com React Query | ‚ùå | Sim |
| Tratamento de erros | ‚ùå | N√£o |
| Feedback visual (toasts) | ‚ùå | N√£o |
| Cache de 5 minutos | ‚ùå | N√£o |

---

## 7. Plano de A√ß√£o Corretiva

### 7.1. Passos Imediatos (Prioridade P0)

#### **Passo 1: Verificar Tarefa 5.0 (Backend)**
**Respons√°vel**: Dev Backend  
**Prazo**: Antes de iniciar frontend  
**A√ß√£o**:
```bash
# Verificar se endpoints existem
curl -X GET http://localhost:5000/api/admin/landing-pages/{id}
curl -X PUT http://localhost:5000/api/admin/landing-pages/{id}
```

**Valida√ß√£o**:
- ‚úÖ Endpoint GET retorna 200
- ‚úÖ Endpoint PUT retorna 204
- ‚úÖ Autentica√ß√£o funcionando
- ‚úÖ Swagger documentado

#### **Passo 2: Criar API Service**
**Arquivo**: `barbapp-admin/src/services/api/landing-page.api.ts`  
**Prazo**: 1 hora  
**Depend√™ncias**: Tarefa 5.0 (Backend) completa

**Implementa√ß√£o**:
```typescript
import { api } from './api';
import type { 
  LandingPageConfig, 
  UpdateLandingPageInput,
  LandingPageConfigOutput 
} from '@/features/landing-page/types/landing-page.types';

export const landingPageApi = {
  getConfig: async (barbershopId: string): Promise<LandingPageConfig> => {
    const { data } = await api.get<LandingPageConfigOutput>(
      `/admin/landing-pages/${barbershopId}`
    );
    return data.landingPage;
  },

  updateConfig: async (
    barbershopId: string,
    payload: UpdateLandingPageInput
  ): Promise<void> => {
    await api.put(`/admin/landing-pages/${barbershopId}`, payload);
  },

  uploadLogo: async (barbershopId: string, file: File): Promise<string> => {
    const formData = new FormData();
    formData.append('logo', file);

    const { data } = await api.post<{ logoUrl: string }>(
      `/admin/landing-pages/${barbershopId}/logo`,
      formData,
      {
        headers: { 'Content-Type': 'multipart/form-data' },
      }
    );

    return data.logoUrl;
  },
};
```

**Valida√ß√£o**:
```bash
# Testar importa√ß√£o
npm run build
# Verificar erros de TypeScript
```

#### **Passo 3: Criar Hook useLandingPage**
**Arquivo**: `barbapp-admin/src/features/landing-page/hooks/useLandingPage.ts`  
**Prazo**: 2 horas  
**Depend√™ncias**: Passo 2

**Implementa√ß√£o**: Ver c√≥digo completo na se√ß√£o 4.1 (CR√çTICO 1)

**Valida√ß√£o**:
- ‚úÖ Hook exporta todas as fun√ß√µes definidas em `UseLandingPageResult`
- ‚úÖ TypeScript compila sem erros
- ‚úÖ Query com `staleTime` de 5 minutos
- ‚úÖ Mutation invalida cache corretamente
- ‚úÖ Toasts de sucesso/erro funcionando

#### **Passo 4: Criar Testes Unit√°rios**
**Arquivo**: `barbapp-admin/src/features/landing-page/hooks/__tests__/useLandingPage.test.ts`  
**Prazo**: 2 horas  
**Depend√™ncias**: Passo 3

**Implementa√ß√£o**: Ver c√≥digo completo na se√ß√£o 4.1 (CR√çTICO 3)

**Comandos**:
```bash
# Rodar testes
npm test -- useLandingPage.test.ts

# Verificar cobertura
npm test -- --coverage useLandingPage.test.ts
```

**Valida√ß√£o**:
- ‚úÖ Todos os testes passando
- ‚úÖ Cobertura > 80%
- ‚úÖ Mocks funcionando corretamente

#### **Passo 5: Integra√ß√£o e Valida√ß√£o**
**Prazo**: 1 hora  
**Depend√™ncias**: Passos 1-4

**Checklist Final**:
- [ ] API service integrado com axios existente
- [ ] Hook usando API service corretamente
- [ ] TanStack Query configurado no contexto da aplica√ß√£o
- [ ] Toast component importado e funcionando
- [ ] Testes passando
- [ ] TypeScript sem erros
- [ ] Code review aprovado

### 7.2. Passos Adicionais (Prioridade P1)

#### **Documenta√ß√£o**
- [ ] Adicionar JSDoc em todas as fun√ß√µes
- [ ] Criar exemplos de uso no README
- [ ] Documentar tipos exportados

#### **Qualidade**
- [ ] Adicionar valida√ß√£o de entrada
- [ ] Implementar retry logic para falhas de rede
- [ ] Adicionar logging de erros

---

## 8. Recomenda√ß√µes T√©cnicas

### 8.1. Arquitetura

#### Recomenda√ß√£o 1: Centralizar hooks de feature
```
features/landing-page/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # Exporta todos os hooks
‚îÇ   ‚îú‚îÄ‚îÄ useLandingPage.ts
‚îÇ   ‚îú‚îÄ‚îÄ useTemplates.ts
‚îÇ   ‚îî‚îÄ‚îÄ useLogoUpload.ts
```

**Benef√≠cios**:
- ‚úÖ Facilita importa√ß√£o
- ‚úÖ Melhora organiza√ß√£o
- ‚úÖ Segue padr√£o do projeto

#### Recomenda√ß√£o 2: Criar hook customizado de toast
```typescript
// hooks/useToast.ts
export const useLandingPageToast = () => {
  const { toast } = useToast();

  return {
    success: (message: string) =>
      toast({ title: 'Sucesso!', description: message, variant: 'success' }),
    error: (error: Error) =>
      toast({ title: 'Erro', description: error.message, variant: 'destructive' }),
  };
};
```

**Benef√≠cios**:
- ‚úÖ Reutiliz√°vel
- ‚úÖ Consistente
- ‚úÖ Test√°vel isoladamente

### 8.2. Performance

#### Recomenda√ß√£o 3: Implementar optimistic updates
```typescript
const updateMutation = useMutation({
  mutationFn: (data: UpdateLandingPageInput) =>
    landingPageApi.updateConfig(barbershopId, data),
  onMutate: async (newData) => {
    // Cancelar queries em andamento
    await queryClient.cancelQueries({ queryKey: ['landingPage', barbershopId] });

    // Snapshot do estado anterior
    const previousData = queryClient.getQueryData(['landingPage', barbershopId]);

    // Atualiza√ß√£o otimista
    queryClient.setQueryData(['landingPage', barbershopId], (old: any) => ({
      ...old,
      ...newData,
    }));

    return { previousData };
  },
  onError: (err, newData, context) => {
    // Rollback em caso de erro
    queryClient.setQueryData(['landingPage', barbershopId], context?.previousData);
  },
});
```

**Benef√≠cios**:
- ‚úÖ UX mais responsiva
- ‚úÖ Reduz perceived latency
- ‚úÖ Rollback autom√°tico em erros

#### Recomenda√ß√£o 4: Prefetch de dados
```typescript
export const usePrefetchLandingPage = (barbershopId: string) => {
  const queryClient = useQueryClient();

  return () => {
    queryClient.prefetchQuery({
      queryKey: ['landingPage', barbershopId],
      queryFn: () => landingPageApi.getConfig(barbershopId),
      staleTime: 5 * 60 * 1000,
    });
  };
};
```

**Uso**:
```typescript
// Em menu ou navega√ß√£o
const prefetch = usePrefetchLandingPage(barbershopId);
<button onMouseEnter={prefetch}>Landing Page</button>
```

### 8.3. Seguran√ßa

#### Recomenda√ß√£o 5: Validar barbershopId
```typescript
export const useLandingPage = (barbershopId: string) => {
  if (!barbershopId || typeof barbershopId !== 'string') {
    throw new Error('barbershopId inv√°lido');
  }

  // ... resto do hook
};
```

#### Recomenda√ß√£o 6: Implementar rate limiting no client
```typescript
import { throttle } from 'lodash-es';

export const useLandingPage = (barbershopId: string) => {
  const updateConfig = useMemo(
    () =>
      throttle((data) => updateMutation.mutate(data), 1000, {
        leading: true,
        trailing: false,
      }),
    [updateMutation]
  );

  return { updateConfig, ... };
};
```

---

## 9. Impacto em Tarefas Dependentes

### 9.1. Tarefas Bloqueadas

#### Tarefa 17.0: Componentes de Edi√ß√£o
**Status**: üî¥ Bloqueada  
**Impacto**: ALTO  
**Motivo**: Componentes precisam do hook `useLandingPage`

**Depend√™ncias**:
- ‚ùå `useLandingPage` para gerenciar estado
- ‚ùå API service para salvar altera√ß√µes
- ‚ùå Types definidos (‚úÖ j√° existe)

**Prazo Estimado**: +4 horas de atraso

#### Tarefa 18.0: P√°gina Principal
**Status**: üî¥ Bloqueada  
**Impacto**: ALTO  
**Motivo**: P√°gina precisa integrar todos os componentes

**Depend√™ncias**:
- ‚ùå Hook `useLandingPage`
- ‚ùå Componentes de edi√ß√£o (Tarefa 17.0)
- ‚ùå Templates (outras tarefas)

**Prazo Estimado**: +8 horas de atraso

### 9.2. Cadeia de Depend√™ncias

```
Tarefa 11.0 (useLandingPage)
    ‚Üì
Tarefa 17.0 (Componentes de Edi√ß√£o)
    ‚Üì
Tarefa 18.0 (P√°gina Principal)
    ‚Üì
Tarefa 19.0 (Testes E2E)
```

**Risco**: Atraso em cascata de **12+ horas** se n√£o corrigido imediatamente.

---

## 10. Estimativa de Esfor√ßo

### 10.1. Tempo de Implementa√ß√£o

| Atividade | Estimativa | Prioridade |
|-----------|------------|------------|
| Criar API Service | 1-2h | P0 |
| Criar Hook useLandingPage | 2-3h | P0 |
| Criar Testes Unit√°rios | 2-3h | P0 |
| Documenta√ß√£o JSDoc | 1h | P1 |
| Code Review + Ajustes | 1-2h | P0 |
| **TOTAL** | **7-11h** | - |

### 10.2. Risco de Atrasos

**Fatores de Risco**:
1. üî¥ **ALTO**: Tarefa 5.0 (Backend) n√£o conclu√≠da
2. ‚ö†Ô∏è **M√âDIO**: Falta de familiaridade com TanStack Query
3. ‚ö†Ô∏è **M√âDIO**: Problemas de integra√ß√£o com API existente
4. ‚úÖ **BAIXO**: Types j√° est√£o definidos

**Mitiga√ß√£o**:
- Priorizar valida√ß√£o do backend (Tarefa 5.0)
- Pair programming para TanStack Query
- Seguir exemplos de outros hooks no projeto

---

## 11. Conclus√£o

### 11.1. Resumo de Problemas

#### üî¥ Cr√≠ticos (Bloqueadores)
1. Hook `useLandingPage` **n√£o implementado**
2. API Service `landing-page.api.ts` **n√£o implementado**
3. Testes unit√°rios **completamente ausentes**
4. Depend√™ncia da Tarefa 5.0 (Backend) **n√£o verificada**

#### ‚ö†Ô∏è Importantes (N√£o-bloqueadores imediatos)
5. Organiza√ß√£o de diret√≥rios inconsistente
6. Falta integra√ß√£o com inst√¢ncia API existente
7. Falta valida√ß√£o de entrada
8. Falta documenta√ß√£o JSDoc

### 11.2. Veredicto Final

**Status**: üî¥ **REPROVADA**

**Raz√µes**:
1. ‚ùå Nenhuma subtarefa foi conclu√≠da (0/6)
2. ‚ùå Nenhum crit√©rio de sucesso foi atingido (0/4)
3. ‚ùå Implementa√ß√£o est√° 0% completa
4. ‚ùå Testes est√£o 0% completos
5. ‚ùå Bloqueia tarefas cr√≠ticas (17.0, 18.0)

**Impacto no Projeto**:
- üî¥ Atraso estimado: **12+ horas** em cascata
- üî¥ Risco de n√£o entregar funcionalidade de Landing Page
- üî¥ Bloqueia desenvolvimento do painel admin

### 11.3. Pr√≥ximos Passos

1. ‚úÖ **IMEDIATO**: Verificar status da Tarefa 5.0 (Backend API)
2. ‚úÖ **URGENTE**: Implementar API Service (1-2h)
3. ‚úÖ **URGENTE**: Implementar Hook useLandingPage (2-3h)
4. ‚úÖ **URGENTE**: Criar testes unit√°rios (2-3h)
5. ‚ö†Ô∏è **IMPORTANTE**: Code review e ajustes (1-2h)
6. ‚ö†Ô∏è **IMPORTANTE**: Documenta√ß√£o (1h)

**Prazo Recomendado**: 1 dia √∫til (8 horas) para completar a tarefa.

---

## 12. Revis√£o Final do Revisor

**Revisor**: GitHub Copilot  
**Data**: 2025-10-21  
**Recomenda√ß√£o**: ‚ùå **REJEITAR** at√© implementa√ß√£o completa

**Coment√°rios Finais**:

A Tarefa 11.0 est√° completamente pendente. Apesar de haver uma base s√≥lida de types (Tarefa 10.0), os componentes cr√≠ticos (hook e API service) n√£o foram implementados. Isso representa um **bloqueio severo** para o progresso do projeto.

A especifica√ß√£o t√©cnica est√° bem definida no `techspec-frontend.md`, o que facilita a implementa√ß√£o. O c√≥digo de refer√™ncia est√° dispon√≠vel e apenas precisa ser adaptado ao contexto do projeto.

**A√ß√£o Requerida**: 
- Priorizar esta tarefa como **P0 (Cr√≠tica)**
- Alocar desenvolvedor frontend experiente com TanStack Query
- Verificar status do backend antes de iniciar
- Implementar com testes desde o in√≠cio (TDD)
- Fazer code review antes de marcar como conclu√≠da

**Estimativa de Recupera√ß√£o**: 8 horas (1 dia √∫til) se iniciado imediatamente.

---

**Assinatura Digital**: GitHub Copilot  
**Vers√£o do Relat√≥rio**: 1.0  
**Pr√≥xima Revis√£o**: Ap√≥s implementa√ß√£o completa
