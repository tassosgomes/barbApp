---
status: pending
parallelizable: true
blocked_by: ["6.0"]
---

<task_context>
<domain>frontend/routing</domain>
<type>implementation</type>
<scope>core_feature</scope>
<complexity>medium</complexity>
<dependencies></dependencies>
<unblocks>8.0</unblocks>
</task_context>

# Tarefa 7.0: Implementar estrutura de rotas dinâmicas com prefixo :codigo

## Visão Geral

Configurar React Router com rotas dinâmicas usando prefixo `/:codigo` para todas as páginas de Admin Barbearia. Criar componente `ProtectedBarbeariaRoute` que valida autenticação e tipo de usuário antes de renderizar rotas protegidas.

<requirements>
- Todas as rotas devem ter prefixo `/:codigo`
- Rotas: /login, /dashboard, /barbeiros, /servicos, /agenda
- ProtectedBarbeariaRoute valida token e tipo de usuário
- Redirecionamento para login se não autenticado
- Isolamento completo de rotas de Admin Central
- Preservar código na URL durante navegação
</requirements>

## Subtarefas

- [ ] 7.1 Criar arquivo `src/routes/adminBarbearia.routes.tsx`
- [ ] 7.2 Implementar `ProtectedBarbeariaRoute` component
- [ ] 7.3 Configurar rotas com prefixo `/:codigo`
- [ ] 7.4 Adicionar validação de autenticação
- [ ] 7.5 Implementar redirecionamento condicional
- [ ] 7.6 Integrar rotas no `src/routes/index.tsx`
- [ ] 7.7 Criar testes unitários para ProtectedBarbeariaRoute
- [ ] 7.8 Criar testes E2E de navegação

## Detalhes de Implementação

### ProtectedBarbeariaRoute

```typescript
// src/components/ProtectedBarbeariaRoute.tsx
import { Navigate, useParams } from 'react-router-dom';
import { adminBarbeariaAuthService } from '@/services/adminBarbeariaAuth.service';
import { useBarbearia } from '@/contexts/BarbeariaContext';

interface ProtectedBarbeariaRouteProps {
  children: React.ReactNode;
}

export function ProtectedBarbeariaRoute({ children }: ProtectedBarbeariaRouteProps) {
  const { codigo } = useParams<{ codigo: string }>();
  const { barbearia, isLoaded } = useBarbearia();
  const isAuthenticated = adminBarbeariaAuthService.isAuthenticated();

  if (!isLoaded) {
    return <div>Carregando...</div>;
  }

  if (!isAuthenticated || !barbearia) {
    return <Navigate to={`/${codigo}/login`} replace />;
  }

  // Validar que o código da URL corresponde ao código do contexto
  if (barbearia.codigo !== codigo) {
    return <Navigate to={`/${barbearia.codigo}/dashboard`} replace />;
  }

  return <>{children}</>;
}
```

### Configuração de Rotas

```typescript
// src/routes/adminBarbearia.routes.tsx
import { Routes, Route } from 'react-router-dom';
import { LoginAdminBarbearia } from '@/pages/LoginAdminBarbearia/LoginAdminBarbearia';
import { Dashboard } from '@/pages/Dashboard/Dashboard';
import { ProtectedBarbeariaRoute } from '@/components/ProtectedBarbeariaRoute';
import { AdminBarbeariaLayout } from '@/layouts/AdminBarbeariaLayout';

export function AdminBarbeariaRoutes() {
  return (
    <Routes>
      <Route path="/:codigo/login" element={<LoginAdminBarbearia />} />
      
      <Route
        path="/:codigo/*"
        element={
          <ProtectedBarbeariaRoute>
            <AdminBarbeariaLayout />
          </ProtectedBarbeariaRoute>
        }
      >
        <Route path="dashboard" element={<Dashboard />} />
        <Route path="barbeiros" element={<div>Barbeiros (placeholder)</div>} />
        <Route path="servicos" element={<div>Serviços (placeholder)</div>} />
        <Route path="agenda" element={<div>Agenda (placeholder)</div>} />
      </Route>
    </Routes>
  );
}
```

### Integração no Router Principal

```typescript
// src/routes/index.tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { AdminBarbeariaRoutes } from './adminBarbearia.routes';
import { AdminCentralRoutes } from './adminCentral.routes'; // Rotas existentes

export function AppRoutes() {
  return (
    <BrowserRouter>
      <Routes>
        {/* Rotas de Admin Central (existentes) */}
        <Route path="/admin/*" element={<AdminCentralRoutes />} />
        
        {/* Rotas de Admin Barbearia (novas) */}
        <Route path="/:codigo/*" element={<AdminBarbeariaRoutes />} />
      </Routes>
    </BrowserRouter>
  );
}
```

## Critérios de Sucesso

- [ ] Rotas com prefixo `/:codigo` funcionam corretamente
- [ ] ProtectedBarbeariaRoute bloqueia acesso sem autenticação
- [ ] Redirecionamento para `/:codigo/login` funciona
- [ ] Código preservado na URL durante navegação
- [ ] Validação de código vs contexto funciona
- [ ] Rotas de Admin Central não são afetadas
- [ ] Testes unitários com cobertura >= 80%
- [ ] Navegação entre páginas funciona sem problemas

## Arquivos Afetados

- `src/components/ProtectedBarbeariaRoute.tsx` (NOVO)
- `src/routes/adminBarbearia.routes.tsx` (NOVO)
- `src/routes/index.tsx` (MODIFICADO)
- `src/components/__tests__/ProtectedBarbeariaRoute.test.tsx` (NOVO)

## Estimativa

- **Esforço:** 1-2 dias
- **Complexidade:** Média
