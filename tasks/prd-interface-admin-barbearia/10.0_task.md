---
status: pending
parallelizable: false
blocked_by: ["9.0"]
---

<task_context>
<domain>frontend/pages/barbeiros</domain>
<type>implementation</type>
<scope>core_feature</scope>
<complexity>high</complexity>
<dependencies>http_server</dependencies>
<unblocks>11.0</unblocks>
</task_context>

# Tarefa 10.0: Implementar páginas de listagem e formulário de barbeiros

## Visão Geral

Criar páginas completas para gestão de barbeiros: listagem com DataTable, formulário de criação/edição, e modais de confirmação. Integrar com serviços da tarefa 9.0 e garantir UX consistente.

<requirements>
- Página de listagem com DataTable
- Filtros e busca
- Paginação
- Formulário de criação/edição
- Modal de confirmação para desativação
- Feedback com toast
- Loading states
- Validação de formulário com Zod
</requirements>

## Subtarefas

- [ ] 10.1 Criar `src/pages/Barbeiros/BarbeirosListPage.tsx`
- [ ] 10.2 Implementar DataTable com colunas
- [ ] 10.3 Adicionar filtros e busca
- [ ] 10.4 Implementar paginação
- [ ] 10.5 Criar `src/pages/Barbeiros/BarbeiroFormPage.tsx`
- [ ] 10.6 Implementar formulário com React Hook Form
- [ ] 10.7 Adicionar validações
- [ ] 10.8 Criar modal `DesativarBarbeiroModal`
- [ ] 10.9 Implementar ações (editar, desativar, reativar)
- [ ] 10.10 Adicionar feedback com toast
- [ ] 10.11 Criar testes unitários
- [ ] 10.12 Criar testes E2E

## Detalhes de Implementação

### Listagem

```typescript
// src/pages/Barbeiros/BarbeirosListPage.tsx
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { barbeiroService } from '@/services/barbeiro.service';
import { useBarbearia } from '@/contexts/BarbeariaContext';
import { DataTable } from '@/components/DataTable';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { toast } from 'sonner';

export function BarbeirosListPage() {
  const navigate = useNavigate();
  const { barbearia } = useBarbearia();
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState('');

  const { data, isLoading } = useQuery({
    queryKey: ['barbeiros', barbearia?.barbeariaId, page, search],
    queryFn: () => barbeiroService.list({ page, pageSize: 10, search }),
    enabled: !!barbearia,
  });

  const deactivateMutation = useMutation({
    mutationFn: barbeiroService.deactivate,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['barbeiros'] });
      toast.success('Barbeiro desativado com sucesso');
    },
  });

  const reactivateMutation = useMutation({
    mutationFn: barbeiroService.reactivate,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['barbeiros'] });
      toast.success('Barbeiro reativado com sucesso');
    },
  });

  const columns = [
    { header: 'Nome', accessorKey: 'nome' },
    { header: 'Email', accessorKey: 'email' },
    { header: 'Telefone', accessorKey: 'telefone' },
    {
      header: 'Status',
      cell: ({ row }: any) => (
        <span className={row.original.isActive ? 'text-green-600' : 'text-red-600'}>
          {row.original.isActive ? 'Ativo' : 'Inativo'}
        </span>
      ),
    },
    {
      header: 'Ações',
      cell: ({ row }: any) => (
        <div className="flex gap-2">
          <Button
            size="sm"
            onClick={() => navigate(`/${barbearia?.codigo}/barbeiros/${row.original.id}`)}
          >
            Editar
          </Button>
          {row.original.isActive ? (
            <Button
              size="sm"
              variant="destructive"
              onClick={() => deactivateMutation.mutate(row.original.id)}
            >
              Desativar
            </Button>
          ) : (
            <Button
              size="sm"
              variant="outline"
              onClick={() => reactivateMutation.mutate(row.original.id)}
            >
              Reativar
            </Button>
          )}
        </div>
      ),
    },
  ];

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">Barbeiros</h1>
        <Button onClick={() => navigate(`/${barbearia?.codigo}/barbeiros/novo`)}>
          Novo Barbeiro
        </Button>
      </div>

      <Input
        placeholder="Buscar por nome ou email..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        className="max-w-sm"
      />

      <DataTable
        columns={columns}
        data={data?.items ?? []}
        isLoading={isLoading}
        pagination={{
          page,
          pageSize: 10,
          totalPages: data?.totalPages ?? 0,
          onPageChange: setPage,
        }}
      />
    </div>
  );
}
```

### Formulário

```typescript
// src/pages/Barbeiros/BarbeiroFormPage.tsx
import { useNavigate, useParams } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQuery } from '@tanstack/react-query';
import { barbeiroService } from '@/services/barbeiro.service';
import { createBarbeiroSchema, type CreateBarbeiroFormData } from '@/schemas/barbeiro.schema';
import { useBarbearia } from '@/contexts/BarbeariaContext';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { toast } from 'sonner';

export function BarbeiroFormPage() {
  const navigate = useNavigate();
  const { id } = useParams();
  const { barbearia } = useBarbearia();
  const isEditing = !!id;

  const { data: barbeiro } = useQuery({
    queryKey: ['barbeiro', id],
    queryFn: () => barbeiroService.getById(id!),
    enabled: isEditing,
  });

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<CreateBarbeiroFormData>({
    resolver: zodResolver(createBarbeiroSchema),
    defaultValues: barbeiro,
  });

  const mutation = useMutation({
    mutationFn: (data: CreateBarbeiroFormData) =>
      isEditing
        ? barbeiroService.update(id!, data)
        : barbeiroService.create(data),
    onSuccess: () => {
      toast.success(`Barbeiro ${isEditing ? 'atualizado' : 'criado'} com sucesso`);
      navigate(`/${barbearia?.codigo}/barbeiros`);
    },
    onError: () => {
      toast.error('Erro ao salvar barbeiro');
    },
  });

  return (
    <div className="max-w-2xl mx-auto">
      <Card>
        <CardHeader>
          <CardTitle>{isEditing ? 'Editar Barbeiro' : 'Novo Barbeiro'}</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit((data) => mutation.mutate(data))} className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Nome</label>
              <Input {...register('nome')} />
              {errors.nome && <p className="text-sm text-red-600">{errors.nome.message}</p>}
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Email</label>
              <Input type="email" {...register('email')} />
              {errors.email && <p className="text-sm text-red-600">{errors.email.message}</p>}
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Telefone</label>
              <Input {...register('telefone')} placeholder="(11) 98765-4321" />
              {errors.telefone && <p className="text-sm text-red-600">{errors.telefone.message}</p>}
            </div>

            <div className="flex gap-2">
              <Button type="submit" disabled={mutation.isPending}>
                {mutation.isPending ? 'Salvando...' : 'Salvar'}
              </Button>
              <Button
                type="button"
                variant="outline"
                onClick={() => navigate(`/${barbearia?.codigo}/barbeiros`)}
              >
                Cancelar
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
```

## Critérios de Sucesso

- [ ] Listagem exibe barbeiros corretamente
- [ ] Filtros e busca funcionam
- [ ] Paginação funciona
- [ ] Formulário de criação funciona
- [ ] Formulário de edição carrega dados corretamente
- [ ] Validações de formulário funcionam
- [ ] Desativar/Reativar funcionam
- [ ] Feedback com toast funciona
- [ ] Testes unitários >= 80%
- [ ] Testes E2E cobrem fluxo completo

## Arquivos Afetados

- `src/pages/Barbeiros/BarbeirosListPage.tsx` (NOVO)
- `src/pages/Barbeiros/BarbeiroFormPage.tsx` (NOVO)
- `src/routes/adminBarbearia.routes.tsx` (MODIFICADO)

## Estimativa

- **Esforço:** 2-3 dias
- **Complexidade:** Alta
